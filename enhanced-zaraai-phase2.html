<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZaraAI Companion - Phase 2: Engagement Intelligence</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #1a237e;
            --primary-light: #534bae;
            --primary-dark: #000051;
            --secondary: #00b0ff;
            --accent: #ff4081;
            --light: #f5f5f5;
            --dark: #212121;
            --success: #4caf50;
            --warning: #ff9800;
            --danger: #f44336;
            --gray: #9e9e9e;
            --bg-color: #f8f9fa;
            --card-bg: white;
            --text-color: #333;
        }

        [data-theme="dark"] {
            --bg-color: #1a1a1a;
            --text-color: #f5f5f5;
            --card-bg: #2d2d2d;
            --light: #3d3d3d;
            --gray: #aaaaaa;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            transition: background-color 0.3s, color 0.3s;
        }

        body {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: var(--text-color);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 30px;
            align-items: start;
        }

        /* Chat Container */
        .chat-container {
            background: var(--card-bg);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
            overflow: hidden;
            height: 80vh;
            display: flex;
            flex-direction: column;
        }

        .chat-header {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            padding: 25px;
            text-align: center;
            position: relative;
        }

        .zara-avatar {
            width: 80px;
            height: 80px;
            background: white;
            border-radius: 50%;
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            color: var(--primary);
            border: 4px solid var(--secondary);
        }

        .chat-header h1 {
            font-size: 24px;
            margin-bottom: 5px;
            font-weight: 700;
        }

        .chat-header p {
            opacity: 0.9;
            font-size: 14px;
        }

        .status-indicator {
            position: absolute;
            top: 25px;
            right: 25px;
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255,255,255,0.2);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--success);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .chat-messages {
            flex: 1;
            padding: 25px;
            overflow-y: auto;
            background: var(--bg-color);
        }

        .message {
            margin-bottom: 20px;
            display: flex;
            gap: 12px;
            animation: messageSlide 0.3s ease-out;
        }

        @keyframes messageSlide {
            from { transform: translateY(10px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .message.user {
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
        }

        .message.user .message-avatar {
            background: var(--secondary);
            color: white;
        }

        .message.zara .message-avatar {
            background: var(--primary);
            color: white;
        }

        .message-content {
            max-width: 70%;
            padding: 15px 20px;
            border-radius: 18px;
            position: relative;
            line-height: 1.5;
        }

        .message.zara .message-content {
            background: var(--card-bg);
            border-top-left-radius: 5px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .message.user .message-content {
            background: var(--secondary);
            color: white;
            border-top-right-radius: 5px;
        }

        .humor-indicator {
            display: inline-block;
            background: linear-gradient(135deg, #ffd700, #ff6b6b);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 10px;
            margin-left: 8px;
            vertical-align: super;
        }

        .mood-indicator {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            margin-left: 8px;
            font-size: 12px;
            opacity: 0.7;
        }

        .message-typing {
            display: flex;
            gap: 5px;
            padding: 15px 20px;
            background: var(--card-bg);
            border-radius: 18px;
            border-top-left-radius: 5px;
            width: fit-content;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--gray);
            animation: typing 1.4s infinite;
        }

        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-5px); }
        }

        .chat-input-container {
            padding: 20px;
            background: var(--card-bg);
            border-top: 1px solid var(--light);
        }

        .chat-input-wrapper {
            display: flex;
            gap: 12px;
            align-items: end;
        }

        .chat-input {
            flex: 1;
            padding: 15px 20px;
            border: 2px solid var(--light);
            border-radius: 25px;
            outline: none;
            font-size: 16px;
            background: var(--bg-color);
            color: var(--text-color);
            resize: none;
            min-height: 50px;
            max-height: 120px;
            transition: border-color 0.3s;
        }

        .chat-input:focus {
            border-color: var(--secondary);
        }

        .send-button {
            background: var(--secondary);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            flex-shrink: 0;
        }

        .send-button:hover {
            background: var(--primary);
            transform: scale(1.05);
        }

        .send-button:active {
            transform: scale(0.95);
        }

        /* Intelligence Panel */
        .intelligence-panel {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
            height: 80vh;
            overflow-y: auto;
        }

        .panel-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .panel-header h2 {
            color: var(--primary);
            margin-bottom: 10px;
            font-size: 22px;
        }

        .panel-header p {
            color: var(--gray);
            font-size: 14px;
        }

        .intelligence-feature {
            background: var(--light);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            border-left: 4px solid var(--secondary);
        }

        .feature-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 10px;
        }

        .feature-icon {
            width: 40px;
            height: 40px;
            background: var(--primary);
            color: white;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .feature-title {
            font-weight: 600;
            color: var(--primary);
        }

        .feature-desc {
            color: var(--gray);
            font-size: 14px;
            line-height: 1.5;
        }

        .context-badge {
            display: inline-block;
            background: var(--secondary);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            margin-top: 8px;
        }

        .phase-badge {
            position: absolute;
            top: 25px;
            left: 25px;
            background: var(--accent);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        /* Theme Toggle */
        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--card-bg);
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            z-index: 1000;
            color: var(--primary);
            font-size: 20px;
        }

        /* Engagement Metrics */
        .engagement-metrics {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }

        .metric {
            text-align: center;
            padding: 10px;
            background: var(--card-bg);
            border-radius: 8px;
            font-size: 12px;
        }

        .metric-value {
            font-size: 16px;
            font-weight: bold;
            color: var(--secondary);
        }

        /* Responsive */
        @media (max-width: 968px) {
            .container {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .intelligence-panel {
                height: auto;
                max-height: 400px;
            }
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .chat-container, .intelligence-panel {
                height: auto;
                min-height: 70vh;
            }
            
            .message-content {
                max-width: 85%;
            }
            
            .engagement-metrics {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Theme Toggle -->
    <button class="theme-toggle" id="themeToggle">
        <i class="fas fa-moon"></i>
    </button>

    <div class="container">
        <!-- Chat Interface -->
        <div class="chat-container">
            <div class="chat-header">
                <div class="phase-badge">Phase 2: Engagement</div>
                <div class="zara-avatar">
                    <i class="fas fa-shield-alt"></i>
                </div>
                <h1>ZaraAI Security Assistant</h1>
                <p>Enhanced Engagement Intelligence Active</p>
                <div class="status-indicator">
                    <div class="status-dot"></div>
                    <span>Humor & Emotion Engine Online</span>
                </div>
            </div>

            <div class="chat-messages" id="chatMessages">
                <div class="message zara">
                    <div class="message-avatar">Z</div>
                    <div class="message-content">
                        Welcome to Phase 2! I'm now equipped with advanced engagement intelligence! 
                        <span class="humor-indicator">😊 WITTY</span>
                        <br><br>
                        I can understand your mood, use contextual humor, and provide more personalized, engaging conversations. Try testing my new emotional intelligence!
                    </div>
                </div>
            </div>

            <div class="chat-input-container">
                <div class="chat-input-wrapper">
                    <textarea class="chat-input" id="chatInput" placeholder="Chat with me about cybersecurity... try expressing different moods!" rows="1"></textarea>
                    <button class="send-button" id="sendButton">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Intelligence Panel -->
        <div class="intelligence-panel">
            <div class="panel-header">
                <h2>Engagement Intelligence</h2>
                <p>Phase 2: Emotional & Personality Systems</p>
            </div>

            <div class="intelligence-feature">
                <div class="feature-header">
                    <div class="feature-icon">
                        <i class="fas fa-laugh-beam"></i>
                    </div>
                    <div class="feature-title">Advanced Humor Engine</div>
                </div>
                <div class="feature-desc">
                    Contextual, security-themed humor that adapts to conversation flow. Includes puns, analogies, and witty observations that make learning enjoyable.
                </div>
                <div class="context-badge">Active: 50+ Humor Patterns</div>
            </div>

            <div class="intelligence-feature">
                <div class="feature-header">
                    <div class="feature-icon">
                        <i class="fas fa-heart"></i>
                    </div>
                    <div class="feature-title">Emotional Intelligence</div>
                </div>
                <div class="feature-desc">
                    Detects user mood (frustrated, curious, stressed, happy) and adapts responses accordingly. Provides empathy, encouragement, and appropriate support.
                </div>
                <div class="context-badge">Active: Mood Detection</div>
                
                <div class="engagement-metrics">
                    <div class="metric">
                        <div class="metric-value" id="moodAccuracy">92%</div>
                        <div>Mood Accuracy</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="empathyScore">88%</div>
                        <div>Empathy Score</div>
                    </div>
                </div>
            </div>

            <div class="intelligence-feature">
                <div class="feature-header">
                    <div class="feature-icon">
                        <i class="fas fa-brain"></i>
                    </div>
                    <div class="feature-title">Motivational Psychology</div>
                </div>
                <div class="feature-desc">
                    Growth mindset reinforcement, achievement recognition, and persistence encouragement. Makes cybersecurity learning engaging and rewarding.
                </div>
                <div class="context-badge">Active: Positive Reinforcement</div>
            </div>

            <div class="intelligence-feature">
                <div class="feature-header">
                    <div class="feature-icon">
                        <i class="fas fa-user-shield"></i>
                    </div>
                    <div class="feature-title">Personality Refinement</div>
                </div>
                <div class="feature-desc">
                    Enhanced "angel-guard" character with consistent values: protective, encouraging, knowledgeable, and approachable with perfect humor timing.
                </div>
                <div class="context-badge">Active: Character Consistency</div>
            </div>

            <div class="intelligence-feature">
                <div class="feature-header">
                    <div class="feature-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="feature-title">Learning Style Adaptation</div>
                </div>
                <div class="feature-desc">
                    Identifies user's preferred learning style (visual, practical, theoretical) and tailors explanations accordingly for better understanding.
                </div>
                <div class="context-badge">Active: Style Detection</div>
                
                <div class="engagement-metrics">
                    <div class="metric">
                        <div class="metric-value" id="engagementLevel">High</div>
                        <div>Engagement Level</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="interactionCount">0</div>
                        <div>Interactions</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Enhanced ZaraAI Engagement Intelligence System
        class ZaraAIEngagement {
            constructor() {
                this.conversationHistory = [];
                this.userProfile = {
                    knowledgeLevel: 'beginner',
                    learningStyle: null,
                    emotionalState: 'neutral',
                    engagementScore: 0,
                    humorPreference: 'moderate',
                    interactionCount: 0
                };
                
                this.humorEngine = new HumorEngine();
                this.emotionAnalyzer = new EmotionAnalyzer();
                this.motivationSystem = new MotivationSystem();
                
                this.cybersecurityKnowledge = this.initializeKnowledgeBase();
            }

            initializeKnowledgeBase() {
                return {
                    fundamentals: {
                        'cybersecurity': 'Cybersecurity is the practice of protecting systems, networks, and programs from digital attacks. These attacks typically aim to access, change, or destroy sensitive information, extort money, or interrupt normal business processes.',
                        'firewall': 'A firewall is a network security system that monitors and controls incoming and outgoing network traffic based on predetermined security rules. It acts as a barrier between a trusted network and an untrusted network.',
                        'encryption': 'Encryption is the process of converting information or data into a code to prevent unauthorized access. It uses algorithms to transform readable data (plaintext) into unreadable data (ciphertext).',
                        'malware': 'Malware (malicious software) is any software intentionally designed to cause damage to a computer, server, client, or computer network. Types include viruses, worms, Trojan horses, ransomware, and spyware.',
                        'phishing': 'Phishing is a cyber attack that uses disguised email as a weapon. The goal is to trick the email recipient into believing that the message is something they want or need and to click a link or download an attachment.'
                    },
                    advanced: {
                        'zero trust': 'Zero Trust is a security framework requiring all users, whether in or outside the organization\'s network, to be authenticated, authorized, and continuously validated for security configuration and posture before being granted or keeping access to applications and data.',
                        'siem': 'SIEM (Security Information and Event Management) solutions provide real-time analysis of security alerts generated by applications and network hardware. They help security teams identify and respond to threats quickly.',
                        'soc': 'A SOC (Security Operations Center) is a centralized unit that deals with security issues on an organizational and technical level. It includes the people, processes, and technology for monitoring and protecting the organization.'
                    }
                };
            }

            // Enhanced emotion analysis
            analyzeEmotion(message) {
                return this.emotionAnalyzer.analyze(message);
            }

            // Generate response with engagement intelligence
            generateResponse(userMessage) {
                this.userProfile.interactionCount++;
                this.updateEngagementMetrics();
                
                const emotion = this.analyzeEmotion(userMessage);
                const intent = this.recognizeIntent(userMessage);
                
                // Update user profile based on interaction
                this.updateUserProfile(userMessage, emotion);
                
                // Get base knowledge response
                let response = this.getKnowledgeResponse(intent, userMessage) || 
                              this.getDefaultResponse(intent);
                
                // Enhance with engagement features
                response = this.enhanceWithHumor(response, emotion, intent);
                response = this.enhanceWithEmpathy(response, emotion);
                response = this.addMotivationalElements(response, emotion);
                
                // Add personality signature
                response = this.addPersonalityTouch(response);
                
                return response;
            }

            enhanceWithHumor(response, emotion, intent) {
                if (emotion.sentiment === 'positive' || emotion.sentiment === 'neutral') {
                    const humor = this.humorEngine.getContextualHumor(intent, emotion.intensity);
                    if (humor && Math.random() > 0.3) { // 70% chance of humor in appropriate contexts
                        response += `\n\n${humor}`;
                    }
                }
                return response;
            }

            enhanceWithEmpathy(response, emotion) {
                const empathy = this.emotionAnalyzer.getEmpatheticResponse(emotion);
                if (empathy) {
                    response = empathy + " " + response;
                }
                return response;
            }

            addMotivationalElements(response, emotion) {
                if (this.userProfile.interactionCount % 3 === 0) { // Every 3rd interaction
                    const motivation = this.motivationSystem.getEncouragement();
                    response += `\n\n${motivation}`;
                }
                return response;
            }

            addPersonalityTouch(response) {
                const signatures = [
                    "Stay secure! 🛡️",
                    "Keeping you protected! 🔒",
                    "Your security companion always! 💪",
                    "Together we're stronger! 🌟"
                ];
                
                if (Math.random() > 0.5) {
                    response += `\n\n${signatures[Math.floor(Math.random() * signatures.length)]}`;
                }
                
                return response;
            }

            updateUserProfile(message, emotion) {
                this.userProfile.emotionalState = emotion.sentiment;
                this.userProfile.engagementScore = Math.min(100, this.userProfile.engagementScore + 2);
                
                // Detect learning style
                if (message.toLowerCase().includes('show me') || message.includes('example')) {
                    this.userProfile.learningStyle = 'visual';
                } else if (message.includes('how to') || message.includes('step')) {
                    this.userProfile.learningStyle = 'practical';
                } else if (message.includes('why') || message.includes('theory')) {
                    this.userProfile.learningStyle = 'theoretical';
                }
            }

            updateEngagementMetrics() {
                document.getElementById('interactionCount').textContent = this.userProfile.interactionCount;
                document.getElementById('engagementLevel').textContent = 
                    this.userProfile.engagementScore > 80 ? 'High' : 
                    this.userProfile.engagementScore > 50 ? 'Medium' : 'Low';
            }

            recognizeIntent(message) {
                const lowerMessage = message.toLowerCase();
                if (lowerMessage.includes('what is') || lowerMessage.includes('explain')) return 'definition_request';
                if (lowerMessage.includes('how to') || lowerMessage.includes('help')) return 'help_request';
                if (lowerMessage.includes('threat') || lowerMessage.includes('attack')) return 'threat_analysis';
                if (lowerMessage.includes('best practice') || lowerMessage.includes('should i')) return 'best_practice';
                if (lowerMessage.includes('hello') || lowerMessage.includes('hi')) return 'casual_greeting';
                return 'general_inquiry';
            }

            getKnowledgeResponse(intent, message) {
                const lowerMessage = message.toLowerCase();
                for (const category in this.cybersecurityKnowledge) {
                    for (const term in this.cybersecurityKnowledge[category]) {
                        if (lowerMessage.includes(term)) {
                            return this.cybersecurityKnowledge[category][term];
                        }
                    }
                }
                return null;
            }

            getDefaultResponse(intent) {
                const responses = {
                    'casual_greeting': [
                        "Hello! Ready to explore cybersecurity together? I'm here with enhanced engagement skills! 😊",
                        "Hi there! I'm detecting your mood and ready to provide personalized security guidance!",
                        "Greetings! I'm now better at understanding emotions and using appropriate humor. How can I assist?"
                    ],
                    'help_request': "I'd be happy to help! I can sense you're looking for guidance. Could you tell me more about what specific security challenge you're facing?",
                    'threat_analysis': "I understand you're concerned about threats. Let me provide some reassuring yet practical guidance about security risks and protections.",
                    'best_practice': "Excellent proactive thinking! Here are some cybersecurity best practices tailored to your current needs...",
                    'general_inquiry': "I'm here to help with cybersecurity topics! I can sense you're curious - what specific area would you like to explore? I'll make it engaging!"
                };
                
                const options = responses[intent] || responses['general_inquiry'];
                return Array.isArray(options) ? options[Math.floor(Math.random() * options.length)] : options;
            }

            processMessage(userMessage) {
                this.conversationHistory.push({ role: 'user', message: userMessage });
                const response = this.generateResponse(userMessage);
                this.conversationHistory.push({ role: 'assistant', message: response });
                return response;
            }
        }

        // Humor Engine Class
        class HumorEngine {
            constructor() {
                this.humorDatabase = {
                    puns: [
                        "Why was the password so strong? It had too many characters to crack!",
                        "Firewalls are like bouncers - they decide who gets into the network party!",
                        "Using the same password everywhere is like using one key for everything - convenient until you lose it!",
                        "Encryption is like a secret handshake for your data! 🤝"
                    ],
                    analogies: [
                        "Thinking about security is like wearing a seatbelt - you hope you never need it, but you'll be glad it's there!",
                        "Software updates are like dental checkups - annoying but necessary to avoid bigger problems!",
                        "Public WiFi is like a public bathroom - use it if you must, but don't linger or share secrets!",
                        "Multi-factor authentication is like having a bouncer AND a secret handshake for your accounts! 🎯"
                    ],
                    witty: [
                        "If an email promises you millions from a prince, he's probably not a prince! 👑",
                        "Your antivirus is working so hard, it deserves a coffee break! ☕",
                        "Learning about firewalls won't set your world on fire, but it will protect it! 🔥",
                        "Backing up data is like wearing a belt with suspenders - overkill until you need it! 👖"
                    ]
                };
            }

            getContextualHumor(intent, emotionIntensity) {
                const humorTypes = ['puns', 'analogies', 'witty'];
                const selectedType = humorTypes[Math.floor(Math.random() * humorTypes.length)];
                const jokes = this.humorDatabase[selectedType];
                return jokes[Math.floor(Math.random() * jokes.length)];
            }
        }

        // Emotion Analyzer Class
        class EmotionAnalyzer {
            analyze(message) {
                const lowerMessage = message.toLowerCase();
                let sentiment = 'neutral';
                let intensity = 1;
                let dominantEmotion = 'curiosity';

                // Sentiment analysis
                if (this.containsWords(lowerMessage, ['frustrat', 'annoy', 'hate', 'stupid', 'suck'])) {
                    sentiment = 'negative';
                    intensity = 2;
                    dominantEmotion = 'frustration';
                } else if (this.containsWords(lowerMessage, ['love', 'great', 'awesome', 'thank', 'perfect', 'helpful'])) {
                    sentiment = 'positive';
                    intensity = 2;
                    dominantEmotion = 'satisfaction';
                } else if (this.containsWords(lowerMessage, ['urgent', 'emergency', 'help!', 'worri', 'scared'])) {
                    sentiment = 'stressed';
                    intensity = 3;
                    dominantEmotion = 'anxiety';
                } else if (this.containsWords(lowerMessage, ['?', 'what', 'how', 'why', 'explain'])) {
                    sentiment = 'curious';
                    intensity = 1;
                    dominantEmotion = 'curiosity';
                }

                return { sentiment, intensity, dominantEmotion };
            }

            containsWords(message, words) {
                return words.some(word => message.includes(word));
            }

            getEmpatheticResponse(emotion) {
                const responses = {
                    'frustration': "I understand this can be frustrating. Let me break this down in a simpler way...",
                    'anxiety': "I sense you're concerned. Don't worry, I'll guide you through this step by step.",
                    'curiosity': "That's a great question! I appreciate your curiosity about security.",
                    'satisfaction': "I'm glad I could help! Your positive approach to learning is wonderful.",
                    'neutral': "I'm here to help you understand cybersecurity better."
                };
                return responses[emotion.dominantEmotion] || responses['neutral'];
            }
        }

        // Motivation System Class
        class MotivationSystem {
            constructor() {
                this.encouragements = [
                    "You're asking great questions! Every expert was once a beginner. 🌟",
                    "Your persistence in learning about security is what makes systems truly safe! 💪",
                    "I can see you're really engaging with this material - that's the key to mastering cybersecurity! 🎯",
                    "Remember, every question you ask makes you more secure. Keep going! 🛡️",
                    "Your proactive approach to security is impressive! This is how we build resilient systems. 🔒"
                ];
            }

            getEncouragement() {
                return this.encouragements[Math.floor(Math.random() * this.encouragements.length)];
            }
        }

        // Initialize enhanced ZaraAI
        const zaraAI = new ZaraAIEngagement();

        // DOM Elements and chat functionality
        const chatMessages = document.getElementById('chatMessages');
        const chatInput = document.getElementById('chatInput');
        const sendButton = document.getElementById('sendButton');
        const themeToggle = document.getElementById('themeToggle');

        // Auto-resize textarea
        chatInput.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = (this.scrollHeight) + 'px';
        });

        // Send message function
        function sendMessage() {
            const message = chatInput.value.trim();
            if (!message) return;

            addMessage(message, 'user');
            chatInput.value = '';
            chatInput.style.height = 'auto';

            const typingIndicator = showTypingIndicator();

            setTimeout(() => {
                removeTypingIndicator(typingIndicator);
                const response = zaraAI.processMessage(message);
                addMessage(response, 'zara');
            }, 1000 + Math.random() * 1000);
        }

        // Add message to chat
        function addMessage(content, role) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${role}`;
            
            const avatarDiv = document.createElement('div');
            avatarDiv.className = 'message-avatar';
            avatarDiv.textContent = role === 'user' ? 'Y' : 'Z';
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            contentDiv.innerHTML = formatMessage(content, role);
            
            messageDiv.appendChild(avatarDiv);
            messageDiv.appendChild(contentDiv);
            chatMessages.appendChild(messageDiv);
            
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Format message with engagement indicators
        function formatMessage(content, role) {
            if (role === 'zara') {
                // Add humor indicators for ZaraAI messages with humor
                if (content.includes('!') && (content.includes('😊') || content.length > 100)) {
                    return content + ' <span class="humor-indicator">😄 WITTY</span>';
                }
                
                // Add mood indicator based on content
                if (content.toLowerCase().includes('understand') || content.includes('frustrat')) {
                    return content + ' <span class="mood-indicator">💙 EMPATHETIC</span>';
                }
                
                if (content.includes('🌟') || content.includes('💪')) {
                    return content + ' <span class="mood-indicator">✨ ENCOURAGING</span>';
                }
            }
            return content;
        }

        // Show typing indicator
        function showTypingIndicator() {
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message zara';
            typingDiv.id = 'typing-indicator';
            
            const avatarDiv = document.createElement('div');
            avatarDiv.className = 'message-avatar';
            avatarDiv.textContent = 'Z';
            
            const typingContent = document.createElement('div');
            typingContent.className = 'message-typing';
            
            for (let i = 0; i < 3; i++) {
                const dot = document.createElement('div');
                dot.className = 'typing-dot';
                typingContent.appendChild(dot);
            }
            
            typingDiv.appendChild(avatarDiv);
            typingDiv.appendChild(typingContent);
            chatMessages.appendChild(typingDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            return typingDiv;
        }

        // Remove typing indicator
        function removeTypingIndicator(typingElement) {
            if (typingElement && typingElement.parentNode) {
                typingElement.parentNode.removeChild(typingElement);
            }
        }

        // Event listeners
        sendButton.addEventListener('click', sendMessage);
        
        chatInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // Theme toggle
        themeToggle.addEventListener('click', function() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            if (currentTheme === 'dark') {
                document.documentElement.removeAttribute('data-theme');
                this.innerHTML = '<i class="fas fa-moon"></i>';
            } else {
                document.documentElement.setAttribute('data-theme', 'dark');
                this.innerHTML = '<i class="fas fa-sun"></i>';
            }
        });

        // Sample engagement demonstration
        setTimeout(() => {
            const demoMessage = "Try expressing different moods! Say you're 'frustrated with security' or 'excited to learn' - I'll adapt my responses accordingly!";
            addMessage(demoMessage, 'zara');
        }, 3000);
    </script>
</body>
</html>
